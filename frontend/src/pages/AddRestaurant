import React, { useState } from "react";
import axios from "axios";
import { FaStore, FaUser, FaEnvelope, FaLock, FaPhone, FaMapMarkerAlt, FaMagic, FaTimes } from "react-icons/fa";

const AddRestaurant = ({ onClose, refreshList }) => {
  const [formData, setFormData] = useState({
    username: "", 
    password: "", 
    restaurantName: "",
    email: "",    
    phone: "",
    address: ""
  });
  const [loading, setLoading] = useState(false);

  // --- LOGIC: AUTO-GENERATE SECURE PASSWORD ---
  const generatePassword = () => {
    const randomPass = Math.random().toString(36).slice(-8).toUpperCase();
    setFormData({ ...formData, password: `BB${randomPass}` }); // BiteBox Prefix
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      // Creates the REAL account in the shared multi-tenant database
      const res = await axios.post("https://smart-menu-backend-5ge7.onrender.com/api/auth/register", formData);
      
      const successMsg = `âœ… Account Created Successfully!\n\nRestaurant: ${formData.restaurantName}\nUsername: ${formData.username}\nPassword: ${formData.password}`;
      alert(successMsg);
      
      // Auto-copy to clipboard for Srinivas to send to owner
      navigator.clipboard.writeText(successMsg);
      
      refreshList(); 
      onClose();     
    } catch (err) {
      alert("Registration Failed: " + (err.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={styles.modalOverlay}>
      <div style={styles.modalCard}>
        <div style={styles.header}>
          <h2 style={styles.title}>Onboard New Partner</h2>
          <button onClick={onClose} style={styles.closeBtn}><FaTimes /></button>
        </div>

        <p style={styles.subtitle}>Setup login credentials for the restaurant owner.</p>

        <form onSubmit={handleSubmit} style={styles.form}>
          <div style={styles.inputGroup}>
            <label style={styles.label}><FaStore /> Restaurant Name</label>
            <input style={styles.input} placeholder="e.g. Skyline Cafe" value={formData.restaurantName} onChange={e => setFormData({...formData, restaurantName: e.target.value})} required />
          </div>

          <div style={styles.inputGroup}>
            <label style={styles.label}><FaUser /> Login Username</label>
            <input style={styles.input} placeholder="e.g. skylineadmin" value={formData.username} onChange={e => setFormData({...formData, username: e.target.value})} required />
          </div>

          <div style={styles.inputGroup}>
            <label style={styles.label}><FaEnvelope /> Owner Email</label>
            <input style={styles.input} type="email" placeholder="owner@email.com" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} required />
          </div>
          
          <div style={styles.inputGroup}>
            <label style={styles.label}><FaLock /> Dashboard Password</label>
            <div style={{ display: 'flex', gap: '10px' }}>
              <input style={{...styles.input, flex: 1}} placeholder="Click Generate" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} required />
              <button type="button" onClick={generatePassword} style={styles.genBtn} title="Generate Password"><FaMagic /></button>
            </div>
          </div>

          <div style={styles.inputGroup}>
            <label style={styles.label}><FaPhone /> Contact Phone</label>
            <input style={styles.input} placeholder="10-digit number" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} />
          </div>

          <button type="submit" style={styles.submitBtn} disabled={loading}>
            {loading ? "Creating..." : "ACTIVATE ACCOUNT"}
          </button>
        </form>
      </div>
    </div>
  );
};

const styles = {
  modalOverlay: { position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(8px)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 },
  modalCard: { background: '#111', padding: '35px', borderRadius: '24px', width: '100%', maxWidth: '450px', border: '1px solid #222', boxShadow: '0 20px 50px rgba(0,0,0,0.5)' },
  header: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '5px' },
  title: { color: 'white', fontSize: '20px', fontWeight: '900', margin: 0 },
  subtitle: { color: '#666', fontSize: '12px', marginBottom: '25px' },
  closeBtn: { background: 'none', border: 'none', color: '#444', fontSize: '20px', cursor: 'pointer' },
  form: { display: 'flex', flexDirection: 'column', gap: '18px' },
  inputGroup: { display: 'flex', flexDirection: 'column', gap: '6px' },
  label: { color: '#f97316', fontSize: '10px', fontWeight: '900', textTransform: 'uppercase', display: 'flex', alignItems: 'center', gap: '8px' },
  input: { padding: '14px', background: '#000', border: '1px solid #333', color: 'white', borderRadius: '12px', fontSize: '14px', outline: 'none' },
  genBtn: { padding: '0 15px', background: '#222', color: '#f97316', border: '1px solid #333', borderRadius: '12px', cursor: 'pointer' },
  submitBtn: { padding: '16px', background: '#f97316', color: 'black', border: 'none', borderRadius: '12px', fontWeight: '900', cursor: 'pointer', marginTop: '10px', textTransform: 'uppercase', letterSpacing: '1px' }
};

export default AddRestaurant;